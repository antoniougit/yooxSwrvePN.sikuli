import csv
from datetime import datetime
from datetime import timedelta
Settings.AutoDetectKeyboardLayout = False
popup("Make sure the content is saved as \\Downloads\\pn.csv before proceeding!")
templateName = input("Please enter the Yoox Template Name:")
templateName = "".join(templateName.split())
campaignName = input("Please enter the Campaign Name:")
campaignName = "".join(campaignName.split())
campaignPhase = select("Please select the Campaign Phase:", options = ("Exploration", "Broadcast"))
linkURL = input("Please enter the Deeplink URL:")
linkURL = "".join(linkURL.split()).replace("\"", "").replace("COUNTRY", "${user.country_shop|fallback='us'}").replace("GENDERLETTER", "${user.gender_short|fallback='w'}")
tp = linkURL[linkURL.index("tp=") + len("tp="):].split("&")[0]

variantContent=[]

with open("C:\\Users\\gantoniou\\Downloads\\pn.csv", 'rb') as csvfile:
    reader = csv.reader(csvfile, delimiter=",")
    next(reader, None)  
    for row in reader:
        if not "".join(row[1]).strip():
            continue
        else:
            variantContent.append(row[1].decode("utf-8"))
variantContent.insert(0, variantContent.pop())

variantNum = len(variantContent)
click("1631691197455.png")
sleep(0.2)
click(Pattern("1631691235418.png").targetOffset(16,0))
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste(templateName)
sleep(1)
wait("1631691587025.png")
click(Pattern("1631699439910.png").similar(0.90).targetOffset(0,33))
sleep(0.2)
click("1631699482999.png")
wait(Pattern("1631699581633.png").similar(0.60),10)
sleep(1)
click(Pattern("1631699439910.png").similar(0.90).targetOffset(0,33))
sleep(0.2)
click("1634122221126.png")
wait("1634122264014.png")
if exists(Pattern("1634122284009.png").exact(),1):
    click(Pattern("1634122284009.png").exact())
    sleep(0.2)
click("1634122348846.png")

sleep(0.2)
click(Pattern("1634212349743.png").exact())
wait(Pattern("1634127149521.png").exact(),10)
click(Pattern("1634127149521.png").exact())
wait("1634212518149.png",10)
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste(campaignName)
click(Pattern("1634212585752.png").exact())
type("a", KeyModifier.CTRL)
type(Key.BACKSPACE)
paste("tp_" + tp)
click("1631692530961.png")
wait(Pattern("1634127179427.png").exact(),10)
click(Pattern("1634127179427.png").exact())
wait("1634212696357.png",10)
if not exists("1634213042223.png",1):
    sleep(0.2)
    click(Pattern("1634212871052.png").exact().targetOffset(125,-25))
    sleep(0.2)
    click(Pattern("1634212871052.png").exact().targetOffset(-125,25))
    sleep(0.2)
click("1631692530961.png")
wait(Pattern("1634127470603.png").exact(),10)
click(Pattern("1634127470603.png").exact())
wait("1634213161537.png",10)
if not exists(Pattern("1634213232091.png").exact(),1):
    click("1631698341731.png")
    sleep(0.2)
    click(Pattern("1631698387855.png").similar(0.90))
    sleep(0.2)
if not exists(Pattern("1634213285748.png").exact(),1):
    click(Pattern("1634213350552.png").exact().targetOffset(0,10))
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    type("2")
    click(Pattern("1634213392939.png").exact())
    sleep(0.1)
    click("1631698517389.png")
    sleep(0.1)
click("1631692530961.png")
for i in range(variantNum):
    wait("1634127673527.png",10)
    click("1634127673527.png")
    wait(Pattern("1634213541596.png").exact(),10)
    click(Pattern("1634213541596.png").exact().targetOffset(0,14))
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(variantContent[i])
    if not exists(Pattern("1634213779049.png").exact(),1):
        click(Pattern("1634213834859.png").exact().targetOffset(0,15))
        sleep(0.2)
        click(Pattern("1634127903571.png").exact())
        sleep(0.2)
    if not exists(Pattern("1634214560307.png").exact(),1):
        click(Pattern("1634214491245.png").exact())
        type(Key.PAGE_DOWN)
    sleep(0.2)
    click(Pattern("1634214560307.png").exact().targetOffset(-36,-30))
    sleep(0.2)
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(linkURL)
    sleep(0.2)
    click(Pattern("1634214824371.png").exact().targetOffset(-38,20))
    sleep(0.2)
    type("a", KeyModifier.CTRL)
    type(Key.BACKSPACE)
    paste(linkURL)
    sleep(0.2)
    click("1631692530961.png")
